# Webサーバのアクセスログの確認  
Webサーバーのアクセスログを見ることで、  
「どのページが人気なのか」「問題が起きた時にどこが問題なのか」を調べることができる。  
## Apacheの設定を確認する
以下のコマンドを使い、Apacheの設定を確認することができる。
```
$ ls -al /etc/apache2
```
### コマンドの構成
・ls: ディレクトリの内容を表示するコマンドです。  
・-a: 「all」の略で、隠しファイル（名前がドットで始まるファイル）も含めてすべてのファイルを表示します。  
・-l: 「long format」の略で、ファイルの詳細情報を表示します。  
・/etc/apache2: 対象となるディレクトリのパスです。この場合、Apache HTTP Server の設定ファイルが格納されているディレクトリです。
## Apacheの設定ファイルで細い設定を見る  
以下のコマンドを使い、Apacheの設定ファイルを確認することができる。(※今回はapache2.confというメインの設定ファイル)
```
$ cat /etc/apache2/apache2.conf
```
### コマンドの構成
・cat: `cat`は「concatenate」の略で、ファイルの内容を標準出力に表示するためのコマンドです。ファイルの内容を画面に表示するために使われます。

・/etc/apache2/apache2.conf: これは Apache HTTP Server のメイン設定ファイルのフルパスです。  
Debian 系（Ubuntu など）のディストリビューションでは、Apache のメイン設定ファイルは通常このパスにあります。

### コマンドの実行結果
コマンドを実行すると、`apache2.conf`ファイルの内容が端末に表示されます。  
このファイルには、Apache HTTP Server の基本的な設定が含まれています。  
内容としては、以下のような設定が含まれることが一般的です
#### １、グローバル設定
・Apache サーバー全体に適用される設定が記述されています。これには、サーバーのルートディレクトリやログファイルの場所、ユーザーやグループの設定などが含まれます。

#### ２、モジュールの設定  
・必要なモジュールの読み込みや設定が記述されています。例えば、LoadModule ディレクティブを使って、特定の機能を有効にするためのモジュールを読み込む設定があります。
#### ３、デフォルトの設定  
・サーバーのデフォルトの動作やセキュリティ設定が記述されています。たとえば、ServerRoot や DocumentRoot などの設定があります。
#### ４、ディレクトリ設定
・サーバーのディレクトリに対するアクセス制御や設定が含まれています。たとえば、<Directory> ディレクティブを使用して、特定のディレクトリに対するアクセス制御を設定することができます。
#### ５、エラーログとアクセスログの設定
・ログファイルの場所やログの形式に関する設定が含まれています。これにより、エラーログやアクセスログの出力先を指定することができます。

## Webサーバーのディレクトリを見る
以下のコマンドを使い、Webサーバーのディレクトリを確認することができる。
```
$ sudo ls -al /var/log/apache2/
```
Apache HTTP Server のログファイルが保存されているディレクトリ /var/log/apache2/ の内容を詳細に表示するために使用します。  
このコマンドの各部分と、その出力内容について詳しく説明します。
### コマンドの構成
・sudo:`sudo`は「superuser do」の略で、管理者権限（スーパーユーザー権限）でコマンドを実行します。これにより、通常のユーザーではアクセスできないファイルやディレクトリにもアクセスできます。  
・ls: ディレクトリの内容を表示するコマンドです。
・-al:  
-a: 「all」の略で、隠しファイル（名前がドットで始まるファイル）も含めてすべてのファイルを表示します。  
-l: 「long format」の略で、ファイルの詳細情報を表示します。  
・/var/log/apache2/: `Apache HTTP Server`のログファイルが保存されているディレクトリのパスです。このディレクトリには、`Apache`のエラーログやアクセスログが含まれています。

## Webサーバーのディレクトリ内にあるアクセスログ（access.log）を見る
以下のコマンドを使い、、Webサーバーのディレクトリにあるアクセスログを確認することがで出来る。
```
$ sudo cat /var/log/apache2/access.log
```
### コマンドの実行結果
コマンドを実行すると、`access.log`ファイルの内容が表示されます。  
ログの内容は通常、以下のような形式になっています（これは一例であり、実際のフォーマットは設定によって異なる場合があります）:
```
192.168.1.1 - - [30/Jul/2024:10:15:22 +0000] "GET /index.html HTTP/1.1" 200 1024
203.0.113.42 - - [30/Jul/2024:10:16:45 +0000] "POST /submit-form HTTP/1.1" 302 512
```
### 出力の各フィールドの説明
#### １、クライアントのIPアドレス:  
・`192.168.1.1`や`203.0.113.42`はリクエストを送信したクライアントのIPアドレスです。    
#### ２、クライアントのID:  
・`-`は通常、クライアントのIDが記録されていないことを示します。クライアントのIDは、ユーザー認証やアプリケーションによって設定されることがありますが、標準のアクセスログには含まれない場合が多いです。
#### ３、ユーザー名:  
・`-`は通常、ユーザー名が記録されていないことを示します。認証済みのユーザー名が記録されることもあります。
#### ４、リクエスト日時:  
・`[30/Jul/2024:10:15:22 +0000]`はリクエストが行われた日時を示します。  
`30/Jul/2024`は日付、`10:15:22`は時刻、`+0000`はタイムゾーンオフセットです。
#### ５、リクエストライン:  
`"GET /index.html HTTP/1.1"`はリクエストの内容を示します。  
・`GET`はHTTPメソッド（この場合は「取得」）です。  
・`/index.html`はリクエストされたリソースのパスです。  
・`HTTP/1.1`は使用されたHTTPバージョンです。  
#### ７、HTTPステータスコード:  
`200`や`302`はサーバーからのレスポンスステータスコードです。  
・`200`はリクエストが成功したことを示します。  
`302`はリダイレクトを示します。  
#### ８、レスポンスサイズ:  
`1024`や`512`はサーバーがクライアントに返したレスポンスのサイズをバイト単位で示します。

## ＜補足＞アクセスログ（エラーログ）をコピーする
「sudo」と「cp」コマンドを使い、アクセスログをコピーすることができる。  
```
$ sudo cp [オプション] コピー元 コピー先
```
今回は`/var/log/apache2`というディレクトリ内にある`error.log`というエラーログを現在のディレクトリ`(home/ubuntu)`にコピーする。  
以下実行コマンド
```
sudo cp /var/log/apache2/error.log /home/ubuntu/
```
